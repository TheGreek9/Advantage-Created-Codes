Option Explicit
Sub IRI()
'If seeking help with macro, contact: Spyro Ziangos - spyro.ziangos@advantagesolutions.net
Dim tabCount As Long
tabCount = ThisWorkbook.Worksheets.Count
If (tabCount = 1) Then
    MsgBox "More Than One Tab Required To Work", vbExclamation
    End
End If
ReDim geo(0 To tabCount - 2) As Variant

Dim colHead() As Variant
Dim colLast As Long
Dim i As Long
Dim name As String
Dim rowLast As Long
Dim s1ColLast As Long
Dim s1RowLast As Long
Dim sheetLast As Long
Dim shp As Shape
Dim ws As Worksheet
Application.ScreenUpdating = False

On Error GoTo ErrorHandler

With ThisWorkbook

If (.Worksheets(2).Range("A1").Value = "Geographies") Then
    MsgBox "Condensed Information Already, Please Check Tab 1", vbExclamation
    End
End If

'Delete empty rows above cells and insert first column
For Each ws In .Worksheets
    For Each shp In ws.Shapes
        shp.Delete
    Next

    Do While (IsEmpty(ws.Cells(1, 3)))
        ws.Rows(1).Delete
    Loop

    If (IsEmpty(ws.Range("A1")) = False And ws.Cells(1, 1) <> ws.Cells(2, 1)) Then
        ws.Range("A:A").Columns.Insert
    End If
Next

'Fill array with geographies from Index
For i = 0 To tabCount - 2
    geo(i) = .Worksheets("Index").Cells(i + 2, 4).Value
Next i



'Fill first column with geography
For i = 2 To tabCount
    rowLast = .Worksheets(i).Range("C" & Worksheets(i).Rows.Count).End(xlUp).Row
    .Worksheets(i).Range("A1:A" & rowLast).Value = geo(i - 2)
    If i > 2 And .Worksheets(i).Range("B1").Value = "Time" Then
        .Worksheets(i).Rows(1).Delete
    End If
Next i

'Paste used range of each sheet to sheet "1"
For i = 3 To tabCount
    s1RowLast = .Worksheets(2).Range("C" & Worksheets(2).Rows.Count).End(xlUp).Row
    rowLast = .Worksheets(i).Range("C" & Worksheets(i).Rows.Count).End(xlUp).Row
    colLast = .Worksheets(i).Cells(1, Columns.Count).End(xlToLeft).Column
    .Worksheets(i).Range(.Worksheets(i).Cells(1, 1), Worksheets(i).Cells(rowLast, colLast)).Copy Destination:=.Worksheets(2).Range("A" & s1RowLast + 1)
Next i

'Delete header rows on sheet "1" after pasting empty tabs
i = 1
Do While (IsEmpty(.Worksheets(2).Cells(i, 1)) = False)
    If (.Worksheets(2).Cells(i, 2).Value = "Category Name" Or .Worksheets(2).Cells(i, 2).Value = "Sub-Category Name") Then
        .Worksheets(2).Rows(i).Delete
        i = i - 1
    End If
    i = i + 1
Loop

''Delete any empty rows on sheet "1". NOT SURE IF KEEPING THIS
'i = 1
'Do While (IsEmpty(.Worksheets(2).Cells(i, 1)) = False)
'    If (IsEmpty(.Worksheets(2).Cells(i, 3)) = True) Then
'        .Worksheets(2).Rows(i).Delete
'        i = i - 1
'    End If
'    i = i + 1
'Loop

'Unmerge cells in Time column
On Error Resume Next:
i = 1
Do While (IsEmpty(.Worksheets(2).Cells(i, 1)) = False)
    If (.Worksheets(2).Cells(i, 2).MergeCells = True) Then
        .Worksheets(2).Cells(i, 2).UnMerge
    End If
    i = i + 1
Loop

'Fill down time to appropriate rows
i = 1
Do While (IsEmpty(.Worksheets(2).Cells(i, 1)) = False)
    If (IsEmpty(.Worksheets(2).Cells(i, 2)) = False) Then
        name = .Worksheets(2).Cells(i, 2).Value
    ElseIf (IsEmpty(.Worksheets(2).Cells(i, 2)) = True) Then
        .Worksheets(2).Cells(i, 2).Value = name
    End If
    i = i + 1
Loop

.Worksheets(2).Range("A1").Value = "Geographies"
.Worksheets(2).Activate
MsgBox "Success!"
End With
Exit Sub

ErrorHandler:
    MsgBox "Error " & Err.Number & ": " & Err.Description & vbNewLine & vbNewLine & _
    "Please Close Report And Try Again;" & vbNewLine & vbNewLine & "If Error Persists, Contact Spyro Ziangos - spyro.ziangos@advantagesolutions.net", vbExclamation
    
Application.ScreenUpdating = True
End Sub





